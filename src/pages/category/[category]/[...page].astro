---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import HorizontalCard from "../../../components/HorizontalCard.astro";
import * as data from "../../../lib/dataHelpers";
import createSlug from "../../../lib/createSlug";
import TeaserList from "../../../components/TeaserList.astro";
import NaviLink from "@components/NaviLink.astro";

export async function getStaticPaths({ paginate }) {
    const allTopics = await data.Topics.getTopicsSortedByDate();

    // Get all unique categories
    const allCategories = [
        ...new Set(allTopics.flatMap((topic) => topic.data.categories || [])),
    ];

    // Create paginated paths for each category
    const categoryPaths = await Promise.all(
        allCategories.map(async (category: string) => {
            const categoryTopics = allTopics.filter(
                (topic) =>
                    topic.data.categories &&
                    topic.data.categories.includes(category),
            );

            const categorySlug = createSlug(category, category);

            return paginate(categoryTopics, {
                params: { category: categorySlug },
                pageSize: 10,
                props: { category },
            });
        }),
    );

    return categoryPaths.flat();
}

const { page } = Astro.props;
const { category } = Astro.props;

const categoryTopics = await data.Topics.getTopicsByCategory(category);
const categoryConferences = await data.Conferences.getConferencesByCategory(category);
const categoryPresentations = await data.Presentations.getPresentationsByCategory(category);
---

<BaseLayout title={`${category} Topics`} sideBarActiveItemID="topics">
    <div class="w-full px-4 sm:px-6 lg:px-8">
        <div class="flex items-center mb-5">
            <div class="flex-none">
                <NaviLink url={`javascript:back()`} />
            </div>
            <div class="text-4xl w-full font-bold">Category: {category}</div>
        </div>

        <div class="my-6">
            <p class="text-gray-600 dark:text-gray-400">
                Explore all topics, conference notes, and presentations in the '{
                    category
                }' category.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <TeaserList title={`Topics`} type="topics" listItems={categoryTopics} />
            <TeaserList title={`Conference Notes`} type="conferences" listItems={categoryConferences} />
            <TeaserList title={`Presentations`} type="presentation" listItems={categoryPresentations} />
        </div>
    </div>
</BaseLayout>
